<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ranking de rendimiento ‚Äî Hurac√°n</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background:#f8f8f8;
      margin:20px;
    }
    h2 {
      color:#b30000;
    }
    table {
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
      background:white;
    }
    th, td {
      padding:8px;
      border-bottom:1px solid #ddd;
      text-align:center;
      font-size:14px;
    }
    th {
      background:#eee;
    }
    td.nombre {
      text-align:left;
      font-weight:bold;
    }
  </style>
</head>

<body>

<h2>üìä Ranking de rendimiento ‚Äî Futbolistas de Hurac√°n</h2>

<div id="ranking">Cargando datos...</div>


  <script>
/* =========================
   FUNCIONES BASE
========================= */

    /* ===============================
       PASO 1: URLs de los CSV
    =============================== */

    const CSV_PARTIDOS =
      "https://raw.githubusercontent.com/globopedia/Artids/main/Artids2000.csv";

    const CSV_ENCUENTROS =
      "https://raw.githubusercontent.com/globopedia/Artids/main/Encuentros_Huracan.csv";


    /* ===============================
       PASO 2: funci√≥n gen√©rica CSV
       (VA AC√Å)
    =============================== */

    function cargarCSV(url, callback) {
      Papa.parse(url, {
        download: true,
        header: true,
        complete: function (results) {
          callback(results.data);
        }
      });
    }


    /* ===============================
       PASO 3: carga encadenada
       (VA AC√Å)
    =============================== */

    cargarCSV(CSV_PARTIDOS, function (partidos) {
      cargarCSV(CSV_ENCUENTROS, function (encuentros) {

        construirRanking(partidos, encuentros);

      });
    });


    /* ===============================
       PASO 4: funci√≥n principal
       (VA AC√Å)
    =============================== */

    function construirRanking(partidos, encuentros) {

      console.log("Partidos:", partidos.length);
      console.log("Encuentros:", encuentros.length);

      // ac√° va tu l√≥gica real de ranking
      document.getElementById("ranking").innerHTML =
        `<p>CSV cargados correctamente</p>`;
    }
    function norm(t) {
  return (t || "")
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .trim();
}

/* =========================
   OBTENER FUTBOLISTAS
========================= */

function obtenerFutbolistasUnicos(encuentros) {
  const set = new Set();

  encuentros.forEach(p => {
    const jugadores = (p.Hurac√°n || "")
      .replace(/[()]/g, ",")
      .replace(/\b\d+(?:\+\d+)?\s*/g, "")
      .replace(/\.+/g, "")
      .replace(/\s+y\s+/gi, ",")
      .replace(/\s+e\s+/gi, ",")
      .replace(/,,+/g, ",")
      .replace(/\s+,/g, ",")
      .replace(/,\s+/g, ",")
      .split(/[,;]+/)
      .map(j => j.trim())
      .filter(j => j.length > 1);

    jugadores.forEach(j => set.add(j));
  });

  return Array.from(set);
}

/* =========================
   CALCULAR RENDIMIENTO
========================= */

function calcularRendimientoFutbolista(nombre, encuentros) {

  const partidos = encuentros.filter(p => {
    const jugadores = (p.Hurac√°n || "")
      .replace(/[()]/g, ",")
      .replace(/\b\d+(?:\+\d+)?\s*/g, "")
      .replace(/\.+/g, "")
      .replace(/\s+y\s+/gi, ",")
      .replace(/\s+e\s+/gi, ",")
      .replace(/,,+/g, ",")
      .replace(/\s+,/g, ",")
      .replace(/,\s+/g, ",")
      .split(/[,;]+/)
      .map(j => j.trim())
      .filter(j => j.length > 1);

    return jugadores.some(j => norm(j) === norm(nombre));
  });

  if (!partidos.length) return null;

  const total = partidos.length;
  const ganados = partidos.filter(p => norm(p.Situaci√≥n) === "victoria").length;
  const empatados = partidos.filter(p => norm(p.Situaci√≥n) === "empate").length;

  const efectividad = ((ganados * 3 + empatados) * 100 / (total * 3));

  return {
    nombre,
    partidos: total,
    efectividad: Number(efectividad.toFixed(1))
  };
}

/* =========================
   GENERAR RANKING
========================= */

function generarRanking(encuentros) {

  const nombres = obtenerFutbolistasUnicos(encuentros);

  return nombres
    .map(n => calcularRendimientoFutbolista(n, encuentros))
    .filter(Boolean)
    .sort((a, b) => b.efectividad - a.efectividad);
}

/* =========================
   RENDER
========================= */

function renderRanking(ranking) {

  const cont = document.getElementById("ranking");

  cont.innerHTML = `
    <table>
      <tr>
        <th>#</th>
        <th>Futbolista</th>
        <th>PJ</th>
        <th>Efectividad</th>
      </tr>
      ${ranking.map((r, i) => `
        <tr>
          <td>${i + 1}</td>
          <td class="nombre">${r.nombre}</td>
          <td>${r.partidos}</td>
          <td>${r.efectividad}%</td>
        </tr>
      `).join("")}
    </table>
  `;
}

/* =========================
   CARGA DEL CSV
========================= */

Papa.parse("https://raw.githubusercontent.com/globopedia/Artids/main/Artids2000.csv", {
  download: true,
  header: true,
  complete: res => {
    const encuentros = res.data;
    const ranking = generarRanking(encuentros);
    renderRanking(ranking);
  }
});
</script>

</body>
</html>
